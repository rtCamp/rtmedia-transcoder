!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=10)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){!function(){e.exports=this.wp.data}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){!function(){e.exports=this.wp.hooks}()},function(e,t){!function(){e.exports=this.regeneratorRuntime}()},function(e,t){function r(e,t,r,o,n,i,a){try{var c=e[i](a),d=c.value}catch(e){return void r(e)}c.done?t(d):Promise.resolve(d).then(o,n)}e.exports=function(e){return function(){var t=this,o=arguments;return new Promise((function(n,i){var a=e.apply(t,o);function c(e){r(a,n,i,c,d,"next",e)}function d(e){r(a,n,i,c,d,"throw",e)}c(void 0)}))}}},function(e,t){!function(){e.exports=this.wp.compose}()},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){!function(){e.exports=this.wp.apiFetch}()},function(e,t,r){"use strict";r.r(t);var o=r(5),n=r.n(o),i=r(6),a=r.n(i),c=r(0),d=r(7),s=r(3),u=r(4),l=r(1),p=r(8),b=r(9),f=r.n(b),m=r(2),v=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Object(c.createElement)(s.Notice,{status:e,isDismissible:r},t)},y=function(e){Object(m.dispatch)("core/notices").createNotice("info",e,{isDismissible:!0,type:"snackbar"})},g=Object(m.select)("core/block-editor"),h=g.getBlocksByClientId,_=g.getClientIdsWithDescendants,k=["amp/amp-story-page","core/video"],O=window.rtTranscoderBlockEditorSupport,j=void 0!==O.rt_default_video_quality?O.rt_default_video_quality:"high",w=void 0!==O.is_transcoding_enabled?O.is_transcoding_enabled:"false";Object(u.addFilter)("blocks.registerBlockType","transcoder/ampStoryBackgroundVideoQuality",(function(e,t){return k.includes(t)&&"amp_story"===O.current_post_type&&"false"!==w?(void 0!==e.attributes&&(e.attributes=Object.assign(e.attributes,{rtBackgroundVideoInfo:{type:"object"},rtBackgroundVideoQuality:{type:"string",default:j}})),e):e}),9);var B=Object(d.createHigherOrderComponent)((function(e){return function(t){if(!k.includes(t.name)||"amp_story"!==O.current_post_type||"false"===w)return Object(c.createElement)(e,t);var r=t.attributes,o="amp/amp-story-page"===t.name,n="core/video"===t.name,i=r.mediaType?r.mediaType:"",a=o?r.mediaId:r.id,d=r.rtBackgroundVideoQuality,u=r.rtBackgroundVideoInfo;return Object(c.createElement)(c.Fragment,null,Object(c.createElement)(e,t),(n||o&&"video"===i)&&void 0!==a&&Object(c.createElement)(p.InspectorControls,null,Object(c.createElement)(s.PanelBody,{title:Object(l.__)("Transcoder Settings","transcoder"),initialOpen:!0},void 0===u&&v("error",Object(l.__)("Please wait while the video is being Transcoded. Quality settings will be available once transcoding is complete.","transcoder"),!1),void 0!==u&&Object(c.createElement)(s.SelectControl,{label:Object(l.__)("Background Video Quality","transcoder"),value:d,options:[{value:"low",label:Object(l.__)("Low","transcoder")},{value:"medium",label:Object(l.__)("Medium","transcoder")},{value:"high",label:Object(l.__)("High","transcoder")}],onChange:function(e){t.setAttributes({rtBackgroundVideoQuality:e})}}))))}}),"withTranscoderSettings");Object(u.addFilter)("editor.BlockEdit","rt-transcoder-amp/with-transcoder-settings",B,12);var V=function(){var e=a()(n.a.mark((function e(t){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,"/transcoder/v1/amp-media",e.next=4,f()({path:"".concat("/transcoder/v1/amp-media","/").concat(t),method:"GET"});case 4:if(!1===(r=e.sent)||null===r){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",!1);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();Object(u.addFilter)("editor.BlockEdit","rt-transcoder-amp/set-media-attributes",(function(e){return function(t){if(!k.includes(t.name)||"amp_story"!==O.current_post_type||"false"===w)return Object(c.createElement)(e,t);var r=t.attributes,o="amp/amp-story-page"===t.name,n="core/video"===t.name;if(void 0!==(o?r.mediaId:r.id))if(void 0===r.poster)o&&void 0!==r.mediaType&&"video"===r.mediaType?(r.mediaUrl.endsWith("mp4")||t.setAttributes({poster:O.amp_story_fallback_poster}),y(Object(l.__)("Please wait while the video is being Transcoded. Video URL and thumbnails will be updated automatically.","transcoder"))):n&&void 0!==r.src&&0!==r.src.indexOf("blob:")&&(r.src.endsWith("mp4")||t.setAttributes({poster:O.amp_video_fallback_poster}),y(Object(l.__)("Please wait while the video is being Transcoded. Video URL and thumbnails will be updated automatically.","transcoder")));else if(void 0!==t.attributes.rtBackgroundVideoInfo){var i=t.attributes.rtBackgroundVideoInfo,a=t.attributes.rtBackgroundVideoQuality?t.attributes.rtBackgroundVideoQuality:j;i.poster.length&&i[a].transcodedMedia.length&&(o&&void 0!==r.mediaType&&"video"===r.mediaType?t.setAttributes({poster:i.poster,mediaUrl:i[a].transcodedMedia,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}):n&&t.setAttributes({poster:i.poster,src:i[a].transcodedMedia,rtBackgroundVideoQuality:a}))}var d=t.attributes.rtBackgroundVideoQuality;return d?t.setAttributes({className:"has-quality-".concat(d)}):t.setAttributes({rtBackgroundVideoQuality:j}),Object(c.createElement)(e,t)}}),11),setInterval((function(){var e=h(_());if(e.length){var t=!0,r=!1,o=void 0;try{for(var n,i=e[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var a=n.value;a.name.length&&k.includes(a.name)&&"amp_story"===O.current_post_type&&"true"===w&&function(){var e=a.attributes,t=a.clientId,r="amp/amp-story-page"===a.name,o="core/video"===a.name,n=r?e.mediaId:e.id,i=document.querySelector("div[data-block='".concat(t,"'] video.editor-amp-story-page-video source"));if(void 0!==t&&void 0===e.rtBackgroundVideoInfo&&void 0!==n&&V(n).then((function(n){if(!1!==n&&null!==n){var a=n,c=e.rtBackgroundVideoQuality?e.rtBackgroundVideoQuality:j;void 0!==a&&a.poster.length&&a[c].transcodedMedia.length&&(r&&void 0!==e.mediaType&&"video"===e.mediaType?(Object(m.dispatch)("core/block-editor").updateBlockAttributes(t,{poster:a.poster,mediaUrl:a[c].transcodedMedia,rtBackgroundVideoInfo:n}),y(Object(l.__)("Video has been Transcoded, you may now select desired quality from block settings.","transcoder")),null!==i&&i.setAttribute("type","video/mp4")):o&&(Object(m.dispatch)("core/block-editor").updateBlockAttributes(t,{poster:a.poster,src:a[c].transcodedMedia,rtBackgroundVideoInfo:n}),y(Object(l.__)("Video has been Transcoded, you may now select desired quality from block settings.","transcoder"))))}})),void 0!==t&&void 0!==e.rtBackgroundVideoInfo&&r&&null!==i){e.className;i.setAttribute("type","video/mp4")}}()}}catch(e){r=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw o}}}}),1e4)}]);